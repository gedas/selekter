!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.selekter={})}(this,function(e){"use strict";var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},o=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++){t=arguments[o];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},n="selection",s=function(){function e(e){this.elements=new Set(e)}return Object.defineProperty(e.prototype,"size",{get:function(){return this.elements.size},enumerable:!0,configurable:!0}),e.prototype.values=function(){return this.elements.values()},e.prototype.add=function(e){var t=this.elements.has(e);return this.elements.add(e),t||this.notify(e,!0),this},e.prototype.delete=function(e){return this.elements.delete(e)&&!this.notify(e,!1)},e.prototype.has=function(e){return this.elements.has(e)},e.prototype.clear=function(){var e=this;this.elements.forEach(function(t){return e.delete(t)})},e.prototype.toggle=function(e,t){return void 0===t?!this.delete(e)&&!!this.add(e):(t?this.add(e):this.delete(e),t)},e.prototype.intersect=function(e){var t=this;return this.elements.forEach(function(o){return!e.has(o)&&t.delete(o)}),this},e.prototype.notify=function(e,t){e.dispatchEvent(new CustomEvent(n,{bubbles:!0,detail:{selected:t}}))},e}(),r=Element.prototype.matches||Element.prototype.msMatchesSelector,i={tick:".selekter-tick"},c=function(){function e(e){var t=this;this.options=e,this.onClick=function(e){var o=e.target.closest(t.area.options.selectable);if(o){var n=t.area.getSelection();(n.size||r.call(e.target,t.options.tick))&&(n.toggle(o),e.stopPropagation())}},this.options=o({},i,e)}return e.prototype.connect=function(e){var t=this;return this.area=e,this.area.root.addEventListener("click",this.onClick,!0),function(){return t.area.root.removeEventListener("click",t.onClick)}},e}(),l=function(){function e(e,t,o,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===o&&(o=0),void 0===n&&(n=0),this.left=e,this.top=t,this.width=o,this.height=n}return e.from=function(t){return new e(t.left,t.top,t.width,t.height)},e.prototype.intersects=function(e){return this.left<=e.left+e.width&&e.left<=this.left+this.width&&this.top<=e.top+e.height&&e.top<=this.top+this.height},e}(),a={lassoClass:"selekter-lasso",threshold:10,boundary:function(e){return e.getBoundingClientRect()}},u=function(e){function n(t){var n=e.call(this)||this;return n.options=t,n.onMouseDown=function(e){0===e.button&&e.target===n.area.root&&(n.origin=n.offset({left:e.clientX,top:e.clientY},n.area.root),n.preservedSelection=e.ctrlKey||e.metaKey?new Set(n.area.getSelection().values()):null,document.addEventListener("mousemove",n.onMouseMove),document.addEventListener("mouseup",n.onMouseUp),e.preventDefault())},n.onMouseMove=function(e){e.preventDefault();var t=n.offset({left:e.clientX,top:e.clientY},n.area.root);n.top=Math.min(n.origin.top,t.top),n.left=Math.min(n.origin.left,t.left),n.width=Math.abs(n.origin.left-t.left),n.height=Math.abs(n.origin.top-t.top),n.setVisible(n.lasso,n.doesEdgePassThreshold())&&(n.lasso||(n.lasso=(n.options.appendTo||n.area.root).appendChild(n.createLassoElement())),n.requestRender()),n.update()},n.onMouseUp=function(e){n.cancelRender(),n.update(),n.width=n.height=0,n.setVisible(n.lasso,!1),document.removeEventListener("mousemove",n.onMouseMove),document.removeEventListener("mouseup",n.onMouseUp)},n.update=function(){var e=n.area.getSelection();n.area.getSelectables().forEach(function(t){return e.toggle(t,n.preservedSelection&&n.preservedSelection.has(t)||n.doesEdgePassThreshold()&&n.intersects(n.boundary(t)))})},n.render=function(){var e=n.lasso.style;e.top=n.top+"px",e.left=n.left+"px",e.width=n.width+"px",e.height=n.height+"px",n.pendingRenderID=0},n.destroy=function(){n.cancelRender(),n.lasso&&(n.lasso.parentElement.removeChild(n.lasso),n.lasso=null),document.removeEventListener("mousedown",n.onMouseDown)},n.options=o({},a,t),n}return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}(n,e),n.prototype.connect=function(e){return this.area=e,document.addEventListener("mousedown",this.onMouseDown),this.destroy},n.prototype.boundary=function(e){return this.offset(l.from(this.options.boundary(e)),this.area.root)},n.prototype.requestRender=function(){this.pendingRenderID||(this.pendingRenderID=requestAnimationFrame(this.render))},n.prototype.cancelRender=function(){this.pendingRenderID&&(cancelAnimationFrame(this.pendingRenderID),this.pendingRenderID=0)},n.prototype.setVisible=function(e,t){return e&&(e.style.display=t?"":"none"),t},n.prototype.doesEdgePassThreshold=function(){return this.width>=this.options.threshold||this.height>=this.options.threshold},n.prototype.offset=function(e,t){return e.top+=t.scrollTop-t.offsetTop+(pageYOffset||document.documentElement.scrollTop),e.left+=t.scrollLeft-t.offsetLeft+(pageXOffset||document.documentElement.scrollLeft),e},n.prototype.createLassoElement=function(){var e=document.createElement("div");return e.className=this.options.lassoClass,e},n}(l),h=[new c,new u],p={selectable:".selekter-selectable",selectionClass:"selekter-selection",selectedClass:"selekter-selected"},d=function(){function e(e,t,r){void 0===r&&(r=h);var i=this;this.root=e,this.options=t,this.selection=new s,this.rootDirty=!0,this.onSelection=function(e){i.root.classList.toggle(i.options.selectionClass,i.selection.size>0),e.target.classList.toggle(i.options.selectedClass,e.detail.selected)},this.options=o({},p,t),this.selectorDestroyers=this.lastUniqueByConstructor(r).map(function(e){return e.connect(i)}),MutationObserver&&(this.observer=new MutationObserver(function(){return i.rootDirty=!0}),this.observer.observe(e,{childList:!0,subtree:!0})),e.addEventListener(n,this.onSelection)}return e.prototype.getSelection=function(){return this.rootDirty&&(this.selection.intersect(this.getSelectables()),this.rootDirty=!this.observer),this.selection},e.prototype.getSelectables=function(){return this.rootDirty&&(this.selectables=new Set(Array.prototype.slice.call(this.root.querySelectorAll(this.options.selectable)).slice()),this.rootDirty=!this.observer),this.selectables},e.prototype.destroy=function(){this.observer&&this.observer.disconnect(),this.selectorDestroyers.forEach(function(e){return e()}),this.root.removeEventListener(n,this.onSelection)},e.prototype.lastUniqueByConstructor=function(e){return e.reduceRight(function(e,t){return!e.some(function(e){return e.constructor===t.constructor})&&e.push(t),e},[])},e}();e.DEFAULT_SELECTORS=h,e.Area=d,e.MouseSelector=c,e.Rect=l,e.RectSelector=u,e.SELECTION_EVENT=n,e.Selection=s,Object.defineProperty(e,"__esModule",{value:!0})});
